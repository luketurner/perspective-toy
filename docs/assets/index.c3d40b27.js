(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))e(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&e(c)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function e(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();let P=[];const eo=o=>{const t=P.findIndex(n=>n.id===o);t>=0&&P.splice(t,1)},A=o=>{eo(o.id),P.push(o)},G=(o,t)=>{const n=[];for(const e of P){const{x:s,y:r,w:c,h:a}=e;o>=s&&o<=s+c&&t>=r&&t<=r+a&&n.push(e)}return n},J=(o,t)=>G(o,t).pop(),so=()=>({before:()=>{P=[]},id:"boxHandler"});let Q=1;const S=[],j=(o,t)=>{for(const n of o==="after"?[...S].reverse():S){const e=n[o];e&&e(t)}},F=o=>{ro(o.id),S.push(o)},ro=o=>{const t=S.findIndex(n=>n.id===o);t>=0&&S.splice(t,1)},l=o=>{j("before",p),p=o(p),j("after",p)};let p={shapes:{},vps:{},horizonY:0,dragging:!1,dragTarget:void 0,hoveredBoxes:{}};const co=o=>({id:Q++,posX:0,...o}),io=o=>({id:Q++,type:"cube",persp:"1p",position:[0,0],size:[100,100],vps:[],...o}),W=o=>{l(t=>(t.horizonY=o,t))},V=o=>{const t=co(o);return l(n=>(n.vps[t.id]=t,n)),t},ao=o=>{const t=io(o);return l(n=>(n.shapes[t.id]=t,n)),t},M=(o,t)=>{l(n=>{const e=n.shapes[o];return e&&(n.shapes[o]={...e,...t}),n})},uo=(o,t)=>{l(n=>{const e=n.vps[o];return e&&(n.vps[o]={...e,...t}),n})},fo=o=>{l(t=>(delete t.shapes[o],t))},U=o=>{l(t=>(delete t.vps[o],t))},po=()=>l(o=>(o.shapes={},o)),lo=()=>l(o=>(o.vps={},o)),ho=o=>l(t=>(t.dragging=!0,t.dragTarget=o,t)),go=()=>l(o=>(o.dragging=!1,o.dragTarget=void 0,o)),b=o=>!!p.hoveredBoxes[o],vo=o=>{l(t=>(t.hoveredBoxes={[o]:!0},t))},xo=o=>{l(t=>(delete t.hoveredBoxes[o],t))},O=o=>{var t;return o&&((t=p.dragTarget)==null?void 0:t.id)===o},w="#44403c",mo="#a8a29e",z="#4d7c0f",R="#4d7c0f",$="#6366f1",q="#4338ca";function wo(){bo(16,16,8,(o,t)=>yo(o,t)),oo(16,750,8,(o,t)=>Bo(o,t,"luketurner/perspective-toy","footer-github","https://github.com/luketurner/perspective-toy"),(o,t)=>Z(o,t,"Copyright 2022 Luke Turner"))}function yo(o,t){return oo(o,t,8,(n,e)=>Z(n,e,"CUBES"),(n,e)=>Y(n,e,"ADD","addCube",()=>{const s=V({posX:400});ao({persp:"1p",position:[350,600],size:[100,100],vps:[s.id]})}),...Object.keys(p.shapes).map((n,e)=>(s,r)=>Y(s,r,(e+1).toString(),"delCube"+n,()=>{const c=parseInt(n,10),a=p.shapes[n];if(a.persp==="1p"){const d=V({posX:200}),f=V({posX:600}),x=a.vps;M(c,{persp:"2p",vps:[d.id,f.id]});for(const h of x)U(h)}else{fo(c);for(const d of a.vps)U(d)}})),(n,e)=>Y(n,e,"CLR","clearCube",()=>{po(),lo()}))}function Y(o,t,n,e,s){i.save();const r=b(e);i.fillStyle=r?z:w,i.strokeStyle=r?z:w,i.font="18px monospace";const c=2,a=i.measureText(n),d=a.width+c*2,f=a.actualBoundingBoxAscent+a.actualBoundingBoxDescent+c*2;return i.strokeRect(o,t,d,f),i.fillText(n,o+c,t+a.actualBoundingBoxAscent+c),i.restore(),A({x:o,y:t,w:d,h:f,id:e,onClick:s}),{w:d,h:f}}function Bo(o,t,n,e,s){i.save();const r=b(e);i.fillStyle=r?q:$,i.strokeStyle=r?q:$,i.font="18px monospace";const c=2,a=i.measureText(n),d=a.width+c*2,f=a.actualBoundingBoxAscent+a.actualBoundingBoxDescent+c*2;return i.fillText(n,o+c,t+a.actualBoundingBoxAscent+c),i.beginPath(),i.moveTo(o+c,t+a.actualBoundingBoxAscent+c+2),i.lineTo(o+d-c,t+a.actualBoundingBoxAscent+c+2),i.stroke(),i.restore(),A({x:o,y:t,w:d,h:f,id:e,onClick:()=>{window.open(s,"_blank")}}),{w:d,h:f}}function Z(o,t,n){i.save(),i.fillStyle=w,i.font="18px monospace";const e=2,s=i.measureText(n),r=s.width+e*2,c=s.actualBoundingBoxAscent+s.actualBoundingBoxDescent+e*2;return i.fillText(n,o+e,t+s.actualBoundingBoxAscent+e),i.restore(),{w:r,h:c}}function bo(o,t,n,...e){let s=t,r=0;for(const c of e){const{h:a,w:d}=c(o,s);s+=a+n,r=Math.max(d,r)}return{w:r,h:s-t}}function oo(o,t,n,...e){let s=o,r=0;for(const c of e){const{w:a,h:d}=c(s,t);s+=a+n,r=Math.max(d,r)}return{h:r,w:s-o}}let i;const Co=(o,t)=>{const n=o.getContext("2d");if(!n)throw new Error(`Cannot find 2D Context for element: ${o}`);i=n,zo(),wo(),Do(t.horizonY);for(const e of Object.values(t.shapes))e.persp==="1p"?ko(e):To(e);for(const e of Object.values(t.vps))Po(e)};function to(o,t,n,e){const s=b(o),r=O(o);no(t,n,r?R:s?z:w),A({id:o,x:t-5,y:n-5,h:10,w:10,onDrag:e})}function ko(o){const[n,e]=o.position,[s]=o.size,r=p.vps[o.vps[0]];g(n,e,r),g(n,e+s,r),g(n+s,e,r),g(n+s,e+s,r);const[c,a]=y(n,e,.25,r),[d,f]=y(n+s,e,.25,r),[x,h]=y(n,e+s,.25,r),[v,m]=y(n+s,e+s,.25,r);So(n,e,s,s),u(n,e,c,a),u(n+s,e,d,f),u(n,e+s,x,h),u(n+s,e+s,v,m),u(c,a,d,f),u(c,a,x,h),u(d,f,v,m),u(x,h,v,m),to("move-"+o.id,n,e,B=>{M(o.id,{position:[B.x,B.y]})})}function To(o){const[n,e]=o.position,[s]=o.size,r=p.vps[o.vps[0]],c=p.vps[o.vps[1]];u(n,e,n,e+s),g(n,e,r),g(n,e+s,r),g(n,e,c),g(n,e+s,c);const[a,d]=E(r),[f,x]=E(c),[h,v]=y(n,e,.25,r),[m,B]=y(n,e,.25,c),[H,L]=y(n,e+s,.25,r),[I,X]=y(n,e+s,.25,c),[C,k]=K(h,v,f,x,m,B,a,d),[T,D]=K(H,L,f,x,I,X,a,d);g(C,k,r),g(C,k,c),g(T,D,r),g(T,D,c),u(n,e,h,v),u(n,e,m,B),u(h,v,C,k),u(m,B,C,k),u(n,e+s,H,L),u(n,e+s,I,X),u(H,L,T,D),u(I,X,T,D),u(h,v,H,L),u(m,B,I,X),u(C,k,T,D),to("move-"+o.id,n,e,N=>{M(o.id,{position:[N.x,N.y]})})}function y(o,t,n,e){const[s,r]=E(e),c=(s-o)*n,a=(r-t)*n;return[o+c,t+a]}function K(o,t,n,e,s,r,c,a){const[d,f]=_(o,t,n,e),[x,h]=_(s,r,c,a),v=(h-f)/(d-x),m=d*v+f;return[v,m]}function _(o,t,n,e){const s=(e-t)/(n-o),r=t-s*o;return[s,r]}function E(o){return[o.posX,p.horizonY]}function g(o,t,n){u(o,t,n.posX,p.horizonY,mo)}function Do(o){const t=i.canvas.width,n="horizon",e=b(n),s=O(n);u(0,o,t,o,s?R:e?z:w);const r=c=>{W(c.y)};A({id:n,x:0,y:o-5,h:10,w:t,onDrag:r})}function Po(o){const t=o.posX,n=p.horizonY,e="vp"+o.id,s=b(e),r=O(e);no(t,n,r?R:s?z:w);const c=a=>{uo(o.id,{posX:a.x})};A({id:e,x:t-5,y:n-5,h:10,w:10,onDrag:c})}function So(o,t,n,e,s=w){i.save(),i.strokeStyle=s,i.beginPath(),i.rect(o,t,n,e),i.stroke(),i.restore()}function u(o,t,n,e,s=w){i.save(),i.strokeStyle=s,i.beginPath(),i.moveTo(o,t),i.lineTo(n,e),i.stroke(),i.restore()}function no(o,t,n=w){i.save(),i.fillStyle=n,i.beginPath(),i.ellipse(o,t,4,4,0,0,2*Math.PI),i.fill(),i.restore()}function zo(){i.save(),i.clearRect(0,0,i.canvas.width,i.canvas.height),i.restore()}const Ao=o=>({after:t=>Co(o,t),id:"draw"}),Ho=o=>(o==null?void 0:o.nodeName)==="CANVAS";function Lo(o,t){const n=J(o,t);!(n!=null&&n.onDrag)||ho(n)}function Io(o,t){var n,e;p.dragging?go():(e=(n=J(o,t))==null?void 0:n.onClick)==null||e.call(n)}function Xo(o,t,n,e){var r,c;p.dragging&&((c=(r=p.dragTarget)==null?void 0:r.onDrag)==null||c.call(r,{x:o,y:t,dx:n,dy:e}));const s=G(o,t);for(const a of s)a&&!b(a.id)&&vo(a.id);for(const a of Object.keys(p.hoveredBoxes))s.find(d=>d.id===a)||xo(a)}const Vo=o=>{if(!Ho(o))throw new Error(`invalid element: ${o}`);o.addEventListener("mousedown",t=>{Lo(t.offsetX,t.offsetY)}),o.addEventListener("mousemove",t=>{Xo(t.offsetX,t.offsetY,t.movementX,t.movementY)}),o.addEventListener("mouseup",t=>{Io(t.offsetX,t.offsetY)}),F(so()),F(Ao(o)),W(400)};Vo(document.getElementById("cubes"));
