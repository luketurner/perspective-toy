(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))e(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&e(c)}).observe(document,{childList:!0,subtree:!0});function o(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function e(i){if(i.ep)return;i.ep=!0;const s=o(i);fetch(i.href,s)}})();let $=[];const bt=t=>{const n=$.findIndex(o=>o.id===t);n>=0&&$.splice(n,1)},j=t=>{bt(t.id),$.push(t)},ut=(t,n)=>{const o=[];for(const e of $)if(e.path)if(Array.isArray(e.path)){for(const i of e.path)if(l.isPointInPath(i,t,n)){o.push(e);break}}else l.isPointInPath(e.path,t,n)&&o.push(e);else{const{x:i,y:s,w:c,h:r}=e;t>=i&&t<=i+c&&n>=s&&n<=s+r&&o.push(e)}return o},ft=(t,n)=>ut(t,n).pop(),yt=()=>{$=[]};let pt=1;const q=[],ot=(t,n)=>{for(const o of t==="after"?[...q].reverse():q){const e=o[t];e&&e(n)}},Ct=t=>{kt(t.id),q.push(t)},kt=t=>{const n=q.findIndex(o=>o.id===t);n>=0&&q.splice(n,1)},f=t=>{ot("before",d),d=t(d),ot("after",d)};let d={shapes:{},vps:{},horizonY:0,dragging:!1,dragTarget:void 0,hoveredBoxes:{},canvasWidth:0,canvasHeight:0};const Ht=t=>({id:pt++,posX:0,...t}),At=t=>({id:pt++,type:"cube",persp:"1p",position:[0,0],size:[100,100],vps:[],...t}),G=t=>{f(n=>(n.horizonY=t,n))},J=t=>{const n=Ht(t);return f(o=>(o.vps[n.id]=n,o)),n},zt=t=>{const n=At(t);return f(o=>(o.shapes[n.id]=n,o)),n},It=(t,n)=>{f(o=>{const e=o.shapes[t];return e&&(o.shapes[t]={...e,...n}),o})},gt=(t,n,o)=>{f(e=>{const i=e.shapes[t];return i&&(i.position=[i.position[0]+n,i.position[1]+o]),e})},Lt=(t,n)=>{f(o=>{const e=o.vps[t];return e&&(o.vps[t]={...e,...n}),o})},Xt=t=>{f(n=>(delete n.shapes[t],n))},et=t=>{f(n=>(delete n.vps[t],n))},St=()=>f(t=>(t.shapes={},t)),Wt=()=>f(t=>(t.vps={},t)),Yt=t=>f(n=>(n.dragging=!0,n.dragTarget=t,n)),Et=()=>f(t=>(t.dragging=!1,t.dragTarget=void 0,t)),P=t=>!!d.hoveredBoxes[t],Vt=t=>{f(n=>(n.hoveredBoxes={[t]:!0},n))},Mt=t=>{f(n=>(delete n.hoveredBoxes[t],n))},vt=t=>{var n;return t&&((n=d.dragTarget)==null?void 0:n.id)===t},st=(t,n)=>{f(o=>(o.canvasHeight=n,o.canvasWidth=t,o))};let l,Pt;const Ot=t=>(t==null?void 0:t.nodeName)==="CANVAS",Z=(t,n,o,e)=>{l.beginPath(),l.moveTo(t,n),l.lineTo(o,e),l.stroke()},Ft=(t,n)=>{l.beginPath(),l.ellipse(t,n,4,4,0,0,2*Math.PI),l.fill()},Rt=()=>l.clearRect(0,0,l.canvas.width,l.canvas.height),U=t=>{l.fillStyle=t},z=t=>{l.strokeStyle=t},it=t=>{l.font=t},K=t=>l.measureText(t),_=(t,n,o)=>{l.fillText(t,n,o)},mt=(t,n,o,e)=>l.strokeRect(t,n,o,e),W=()=>l.save(),Y=()=>l.restore(),Nt=()=>l.canvas.width;function jt(t,n){const o=ft(t,n);!(o!=null&&o.onDrag)||Yt(o)}function Ut(t,n){var o,e;d.dragging?Et():(e=(o=ft(t,n))==null?void 0:o.onClick)==null||e.call(o)}function ct(t,n,o,e){var s,c;d.dragging&&((c=(s=d.dragTarget)==null?void 0:s.onDrag)==null||c.call(s,{x:t,y:n,dx:o,dy:e}));const i=ut(t,n);for(const r of i)r&&!P(r.id)&&Vt(r.id);for(const r of Object.keys(d.hoveredBoxes))i.find(a=>a.id===r)||Mt(r)}const $t=()=>{Rt(),yt(),l.save(),Pt(),l.restore()},qt=(t,n)=>{const o=t.getContext("2d");if(!o)throw new Error(`Cannot find 2D Context for element: ${t}`);if(typeof n!="function")throw new Error(`renderFn ${n} is not a function`);return l=o,Pt=n,t.addEventListener("pointerdown",e=>jt(e.offsetX,e.offsetY)),t.addEventListener("pointerup",e=>Ut(e.offsetX,e.offsetY)),t.addEventListener("pointermove",e=>e.pointerType==="touch"?ct(e.offsetX,e.offsetY,-e.movementX,-e.movementY):ct(e.offsetX,e.offsetY,e.movementX,e.movementY)),t.height=d.canvasHeight,t.width=d.canvasWidth,{after:e=>{t.height=e.canvasHeight,t.width=e.canvasWidth,requestAnimationFrame($t)},id:"draw"}},y="#44403c",wt="#a8a29e",S="#4d7c0f",Tt="#a8a29e",xt="#4d7c0f",rt="#6366f1",at="#4338ca",tt="#dc2626";function Kt(){it("20px monospace"),Qt(16,16,8,(t,n)=>_t(t,n)),it("16px monospace"),Dt(16,d.canvasHeight-36,8,(t,n)=>Jt(t,n,"luketurner/perspective-toy","footer-github","https://github.com/luketurner/perspective-toy"),(t,n)=>Bt(t,n,"Copyright 2022 Luke Turner"))}function _t(t,n){return Dt(t,n,8,(o,e)=>Bt(o,e,"CUBES"),(o,e)=>dt(o,e,"ADD","addCube",()=>{const i=J({posX:d.canvasWidth/2}),s=Math.min(100,d.canvasWidth/5,d.canvasHeight/5);zt({persp:"1p",position:[d.canvasWidth/2,d.canvasHeight/3*2],size:[s,s],vps:[i.id]})}),...Object.keys(d.shapes).map((o,e)=>(i,s)=>Gt(i,s,o,(e+1).toString())),(o,e)=>dt(o,e,"CLR","clearCube",()=>{St(),Wt()},tt))}function Gt(t,n,o,e){W();const i="cubeBtn"+o,s="cube"+o,c=P(i)||P(s);U(c?S:y),z(c?S:y);const r=4,a=K(e),h=a.width+r*2,u=a.actualBoundingBoxAscent+a.actualBoundingBoxDescent+r*2;return mt(t,n,h,u),_(e,t+r,n+a.actualBoundingBoxAscent+r),Y(),j({x:t,y:n,w:h,h:u,id:i,onClick:()=>{const m=parseInt(o,10),w=d.shapes[o];if(w.persp==="1p"){const T=J({posX:d.canvasWidth/3}),C=J({posX:d.canvasWidth/3*2}),k=w.vps;It(m,{persp:"2p",vps:[T.id,C.id]});for(const H of k)et(H)}else{Xt(m);for(const T of w.vps)et(T)}}}),{w:h,h:u}}function dt(t,n,o,e,i,s){W();const c=P(e);U(c?s||S:y),z(c?s||S:y);const r=4,a=K(o),h=a.width+r*2,u=a.actualBoundingBoxAscent+a.actualBoundingBoxDescent+r*2;return mt(t,n,h,u),_(o,t+r,n+a.actualBoundingBoxAscent+r),Y(),j({x:t,y:n,w:h,h:u,id:e,onClick:i}),{w:h,h:u}}function Jt(t,n,o,e,i){W();const s=P(e);U(s?at:rt),z(s?at:rt);const c=4,r=K(o),a=r.width+c*2,h=r.actualBoundingBoxAscent+r.actualBoundingBoxDescent+c*2;return _(o,t+c,n+r.actualBoundingBoxAscent+c),Z(t+c,n+r.actualBoundingBoxAscent+c+2,t+a-c,n+r.actualBoundingBoxAscent+c+2),Y(),j({x:t,y:n,w:a,h,id:e,onClick:()=>{window.open(i,"_blank")}}),{w:a,h}}function Bt(t,n,o){W(),U(y);const e=4,i=K(o),s=i.width+e*2,c=i.actualBoundingBoxAscent+i.actualBoundingBoxDescent+e*2;return _(o,t+e,n+i.actualBoundingBoxAscent+e),Y(),{w:s,h:c}}function Qt(t,n,o,...e){let i=n,s=0;for(const c of e){const{h:r,w:a}=c(t,i);i+=r+o,s=Math.max(a,s)}return{w:s,h:i-n}}function Dt(t,n,o,...e){let i=t,s=0;for(const c of e){const{w:r,h:a}=c(i,n);i+=r+o,s=Math.max(a,s)}return{h:s,w:i-t}}const Zt=()=>{z(y),U(y),Kt(),on(d.horizonY);for(const t of Object.values(d.shapes))t.persp==="1p"?tn(t):nn(t);for(const t of Object.values(d.vps))en(t)};function tn(t){W();const n="cube"+t.id,o=P("clearCube"),e=P(n)||P("cubeBtn"+t.id),i=.25,[s,c]=t.position,[r,a]=t.size,h=d.vps[t.vps[0]],[u,A]=X(s,c,i,h),[m,w]=X(s+r,c,i,h),[T,C]=X(s,c+r,i,h),[k,H]=X(s+r,c+r,i,h);z(e?Tt:wt),b(s,c,h),b(s,c+r,h),b(s+r,c,h),b(s+r,c+r,h),z(o?tt:e?S:y);const I=new Path2D;I.rect(s,c,r,a);const x=new Path2D;x.moveTo(s,c),x.lineTo(u,A),x.lineTo(m,w),x.lineTo(s+r,c),x.closePath();const B=new Path2D;B.moveTo(s,c+a),B.lineTo(T,C),B.lineTo(k,H),B.lineTo(s+r,c+a),B.closePath();const D=new Path2D;D.moveTo(s,c),D.lineTo(u,A),D.lineTo(T,C),D.lineTo(s,c+a),D.closePath();const p=new Path2D;p.moveTo(s+r,c),p.lineTo(m,w),p.lineTo(k,H),p.lineTo(s+r,c+a),p.closePath();const g=new Path2D;g.moveTo(u,A),g.lineTo(m,w),g.lineTo(k,H),g.lineTo(T,C),g.closePath();const v=new Path2D;v.addPath(x),v.addPath(B),v.addPath(D),v.addPath(g),v.addPath(I),v.addPath(p),l.stroke(v),j({id:n,path:[x,B,D,g,I,p],onDrag(L){gt(t.id,L.dx,L.dy)}}),Y()}function nn(t){W();const n="cube"+t.id,o=P("clearCube"),e=P(n)||P("cubeBtn"+t.id),i=.25,[s,c]=t.position,[r]=t.size,a=d.vps[t.vps[0]],h=d.vps[t.vps[1]],[u,A]=Q(a),[m,w]=Q(h),[T,C]=X(s,c,i,a),[k,H]=X(s,c,i,h),[I,x]=X(s,c+r,i,a),[B,D]=X(s,c+r,i,h),[p,g]=ht(T,C,m,w,k,H,u,A),[v,L]=ht(I,x,m,w,B,D,u,A);z(e?Tt:wt),b(s,c,a),b(s,c+r,a),b(s,c,h),b(s,c+r,h),b(p,g,a),b(p,g,h),b(v,L,a),b(v,L,h),z(o?tt:e?S:y);const E=new Path2D;E.moveTo(s,c),E.lineTo(T,C),E.lineTo(p,g),E.lineTo(k,H),E.closePath();const V=new Path2D;V.moveTo(s,c+r),V.lineTo(I,x),V.lineTo(v,L),V.lineTo(B,D),V.closePath();const M=new Path2D;M.moveTo(s,c),M.lineTo(T,C),M.lineTo(I,x),M.lineTo(s,c+r),M.closePath();const O=new Path2D;O.moveTo(T,C),O.lineTo(p,g),O.lineTo(v,L),O.lineTo(I,x),O.closePath();const F=new Path2D;F.moveTo(s,c),F.lineTo(k,H),F.lineTo(B,D),F.lineTo(s,c+r),F.closePath();const R=new Path2D;R.moveTo(k,H),R.lineTo(p,g),R.lineTo(v,L),R.lineTo(B,D),R.closePath();const N=new Path2D;N.addPath(E),N.addPath(V),N.addPath(M),N.addPath(O),N.addPath(F),N.addPath(R),l.stroke(N),j({id:n,path:[E,V,M,O,F,R],onDrag(nt){gt(t.id,nt.dx,nt.dy)}}),Y()}function X(t,n,o,e){const[i,s]=Q(e),c=(i-t)*o,r=(s-n)*o;return[t+c,n+r]}function ht(t,n,o,e,i,s,c,r){const[a,h]=lt(t,n,o,e),[u,A]=lt(i,s,c,r),m=(A-h)/(a-u),w=a*m+h;return[m,w]}function lt(t,n,o,e){const i=(e-n)/(o-t),s=n-i*t;return[i,s]}function Q(t){return[t.posX,d.horizonY]}function b(t,n,o){Z(t,n,o.posX,d.horizonY)}function on(t){W();const n=Nt(),o="horizon",e=P(o),i=vt(o);z(i?xt:e?S:y),Z(0,t,n,t);const s=c=>{G(c.y)};j({id:o,x:0,y:t-5,h:10,w:n,onDrag:s}),Y()}function en(t){W();const n=t.posX,o=d.horizonY,e="vp"+t.id,i=P(e),s=vt(e);U(s?xt:i?S:y),Ft(n,o);const c=r=>{Lt(t.id,{posX:r.x})};j({id:e,x:n-5,y:o-5,h:10,w:10,onDrag:c}),Y()}const sn=t=>{if(!Ot(t))throw new Error(`invalid element: ${t}`);st(window.innerWidth,window.innerHeight),window.addEventListener("resize",()=>{st(window.innerWidth,window.innerHeight),d.horizonY>=d.canvasHeight&&G(t.height*.9)}),Ct(qt(t,Zt)),G(d.canvasHeight/2)};sn(document.getElementById("cubes"));
