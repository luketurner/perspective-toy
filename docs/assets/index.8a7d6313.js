(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function t(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerpolicy&&(r.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?r.credentials="include":e.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(e){if(e.ep)return;e.ep=!0;const r=t(e);fetch(e.href,r)}})();let Y=[];const xn=n=>{const o=Y.findIndex(t=>t.id===n);o>=0&&Y.splice(o,1)},I=n=>{xn(n.id),Y.push(n)},rn=(n,o)=>{const t=[];for(const s of Y){const{x:e,y:r,w:c,h:i}=s;n>=e&&n<=e+c&&o>=r&&o<=r+i&&t.push(s)}return t},cn=(n,o)=>rn(n,o).pop(),mn=()=>{Y=[]};let an=1;const E=[],J=(n,o)=>{for(const t of n==="after"?[...E].reverse():E){const s=t[n];s&&s(o)}},Bn=n=>{wn(n.id),E.push(n)},wn=n=>{const o=E.findIndex(t=>t.id===n);o>=0&&E.splice(o,1)},v=n=>{J("before",f),f=n(f),J("after",f)};let f={shapes:{},vps:{},horizonY:0,dragging:!1,dragTarget:void 0,hoveredBoxes:{}};const bn=n=>({id:an++,posX:0,...n}),yn=n=>({id:an++,type:"cube",persp:"1p",position:[0,0],size:[100,100],vps:[],...n}),dn=n=>{v(o=>(o.horizonY=n,o))},F=n=>{const o=bn(n);return v(t=>(t.vps[o.id]=o,t)),o},Cn=n=>{const o=yn(n);return v(t=>(t.shapes[o.id]=o,t)),o},$=(n,o)=>{v(t=>{const s=t.shapes[n];return s&&(t.shapes[n]={...s,...o}),t})},kn=(n,o)=>{v(t=>{const s=t.vps[n];return s&&(t.vps[n]={...s,...o}),t})},Dn=n=>{v(o=>(delete o.shapes[n],o))},Q=n=>{v(o=>(delete o.vps[n],o))},An=()=>v(n=>(n.shapes={},n)),Hn=()=>v(n=>(n.vps={},n)),Ln=n=>v(o=>(o.dragging=!0,o.dragTarget=n,o)),Tn=()=>v(n=>(n.dragging=!1,n.dragTarget=void 0,n)),h=n=>!!f.hoveredBoxes[n],zn=n=>{v(o=>(o.hoveredBoxes={[n]:!0},o))},In=n=>{v(o=>(delete o.hoveredBoxes[n],o))},q=n=>{var o;return n&&((o=f.dragTarget)==null?void 0:o.id)===n};let u,un;const Pn=n=>(n==null?void 0:n.nodeName)==="CANVAS",d=(n,o,t,s)=>{u.beginPath(),u.moveTo(n,o),u.lineTo(t,s),u.stroke()},fn=(n,o)=>{u.beginPath(),u.ellipse(n,o,4,4,0,0,2*Math.PI),u.fill()},Sn=()=>u.clearRect(0,0,u.canvas.width,u.canvas.height),T=n=>{u.fillStyle=n},k=n=>{u.strokeStyle=n},Z=n=>{u.font=n},N=n=>u.measureText(n),j=(n,o,t)=>{u.fillText(n,o,t)},K=(n,o,t,s)=>u.strokeRect(n,o,t,s),A=()=>u.save(),H=()=>u.restore(),Xn=()=>u.canvas.width;function Vn(n,o){const t=cn(n,o);!(t!=null&&t.onDrag)||Ln(t)}function Yn(n,o){var t,s;f.dragging?Tn():(s=(t=cn(n,o))==null?void 0:t.onClick)==null||s.call(t)}function En(n,o,t,s){var r,c;f.dragging&&((c=(r=f.dragTarget)==null?void 0:r.onDrag)==null||c.call(r,{x:n,y:o,dx:t,dy:s}));const e=rn(n,o);for(const i of e)i&&!h(i.id)&&zn(i.id);for(const i of Object.keys(f.hoveredBoxes))e.find(a=>a.id===i)||In(i)}const Mn=()=>{Sn(),mn(),u.save(),un(),u.restore()},On=(n,o)=>{if(!Pn(n))throw new Error(`invalid element: ${n}`);const t=n.getContext("2d");if(!t)throw new Error(`Cannot find 2D Context for element: ${n}`);if(typeof o!="function")throw new Error(`renderFn ${o} is not a function`);return u=t,un=o,n.addEventListener("mousedown",s=>Vn(s.offsetX,s.offsetY)),n.addEventListener("mouseup",s=>Yn(s.offsetX,s.offsetY)),n.addEventListener("mousemove",s=>En(s.offsetX,s.offsetY,s.movementX,s.movementY)),{after:s=>requestAnimationFrame(Mn),id:"draw"}},w="#44403c",ln="#a8a29e",D="#4d7c0f",pn="#a8a29e",W="#4d7c0f",nn="#6366f1",on="#4338ca",_="#dc2626";function Rn(){Z("20px monospace"),Un(16,16,8,(n,o)=>Nn(n,o)),Z("16px monospace"),hn(16,750,8,(n,o)=>Fn(n,o,"luketurner/perspective-toy","footer-github","https://github.com/luketurner/perspective-toy"),(n,o)=>gn(n,o,"Copyright 2022 Luke Turner"))}function Nn(n,o){return hn(n,o,8,(t,s)=>gn(t,s,"CUBES"),(t,s)=>tn(t,s,"ADD","addCube",()=>{const e=F({posX:400});Cn({persp:"1p",position:[350,600],size:[100,100],vps:[e.id]})}),...Object.keys(f.shapes).map((t,s)=>(e,r)=>jn(e,r,t,(s+1).toString())),(t,s)=>tn(t,s,"CLR","clearCube",()=>{An(),Hn()},_))}function jn(n,o,t,s){A();const e="cubeBtn"+t,r="cubeHandle"+t,c=h(e)||h(r);T(c?D:w),k(c?D:w);const i=4,a=N(s),l=a.width+i*2,p=a.actualBoundingBoxAscent+a.actualBoundingBoxDescent+i*2;return K(n,o,l,p),j(s,n+i,o+a.actualBoundingBoxAscent+i),H(),I({x:n,y:o,w:l,h:p,id:e,onClick:()=>{const x=parseInt(t,10),g=f.shapes[t];if(g.persp==="1p"){const m=F({posX:200}),b=F({posX:600}),C=g.vps;$(x,{persp:"2p",vps:[m.id,b.id]});for(const z of C)Q(z)}else{Dn(x);for(const m of g.vps)Q(m)}}}),{w:l,h:p}}function tn(n,o,t,s,e,r){A();const c=h(s);T(c?r||D:w),k(c?r||D:w);const i=4,a=N(t),l=a.width+i*2,p=a.actualBoundingBoxAscent+a.actualBoundingBoxDescent+i*2;return K(n,o,l,p),j(t,n+i,o+a.actualBoundingBoxAscent+i),H(),I({x:n,y:o,w:l,h:p,id:s,onClick:e}),{w:l,h:p}}function Fn(n,o,t,s,e){A();const r=h(s);T(r?on:nn),k(r?on:nn);const c=4,i=N(t),a=i.width+c*2,l=i.actualBoundingBoxAscent+i.actualBoundingBoxDescent+c*2;return j(t,n+c,o+i.actualBoundingBoxAscent+c),d(n+c,o+i.actualBoundingBoxAscent+c+2,n+a-c,o+i.actualBoundingBoxAscent+c+2),H(),I({x:n,y:o,w:a,h:l,id:s,onClick:()=>{window.open(e,"_blank")}}),{w:a,h:l}}function gn(n,o,t){A(),T(w);const s=4,e=N(t),r=e.width+s*2,c=e.actualBoundingBoxAscent+e.actualBoundingBoxDescent+s*2;return j(t,n+s,o+e.actualBoundingBoxAscent+s),H(),{w:r,h:c}}function Un(n,o,t,...s){let e=o,r=0;for(const c of s){const{h:i,w:a}=c(n,e);e+=i+t,r=Math.max(a,r)}return{w:r,h:e-o}}function hn(n,o,t,...s){let e=n,r=0;for(const c of s){const{w:i,h:a}=c(e,o);e+=i+t,r=Math.max(a,r)}return{h:r,w:e-n}}const $n=()=>{k(w),T(w),Rn(),Wn(f.horizonY);for(const n of Object.values(f.shapes))n.persp==="1p"?qn(n):Kn(n);for(const n of Object.values(f.vps))_n(n)};function vn(n,o,t,s){A();const e="cubeHandle"+n.id,r="cubeBtn"+n.id,c=h(e)||h(r),i=q(e);T(i?W:c?D:w),fn(o,t),I({id:e,x:o-5,y:t-5,h:10,w:10,onDrag:s}),H()}function qn(n){A();const o=h("clearCube"),t=h("cubeBtn"+n.id),s=.25,[e,r]=n.position,[c]=n.size,i=f.vps[n.vps[0]];k(t?pn:ln),B(e,r,i),B(e,r+c,i),B(e+c,r,i),B(e+c,r+c,i),k(o?_:t?D:w);const[a,l]=L(e,r,s,i),[p,y]=L(e+c,r,s,i),[x,g]=L(e,r+c,s,i),[m,b]=L(e+c,r+c,s,i);K(e,r,c,c),d(e,r,a,l),d(e+c,r,p,y),d(e,r+c,x,g),d(e+c,r+c,m,b),d(a,l,p,y),d(a,l,x,g),d(p,y,m,b),d(x,g,m,b),vn(n,e,r,C=>{$(n.id,{position:[C.x,C.y]})}),H()}function Kn(n){A();const o=h("clearCube"),t=h("cubeBtn"+n.id),s=.25,[e,r]=n.position,[c]=n.size,i=f.vps[n.vps[0]],a=f.vps[n.vps[1]],[l,p]=U(i),[y,x]=U(a),[g,m]=L(e,r,s,i),[b,C]=L(e,r,s,a),[z,M]=L(e,r+c,s,i),[O,R]=L(e,r+c,s,a),[P,S]=en(g,m,y,x,b,C,l,p),[X,V]=en(z,M,y,x,O,R,l,p);k(t?pn:ln),B(e,r,i),B(e,r+c,i),B(e,r,a),B(e,r+c,a),B(P,S,i),B(P,S,a),B(X,V,i),B(X,V,a),k(o?_:t?D:w),d(e,r,g,m),d(e,r,b,C),d(g,m,P,S),d(b,C,P,S),d(e,r+c,z,M),d(e,r+c,O,R),d(z,M,X,V),d(O,R,X,V),d(e,r,e,r+c),d(g,m,z,M),d(b,C,O,R),d(P,S,X,V),vn(n,e,r,G=>{$(n.id,{position:[G.x,G.y]})}),H()}function L(n,o,t,s){const[e,r]=U(s),c=(e-n)*t,i=(r-o)*t;return[n+c,o+i]}function en(n,o,t,s,e,r,c,i){const[a,l]=sn(n,o,t,s),[p,y]=sn(e,r,c,i),x=(y-l)/(a-p),g=a*x+l;return[x,g]}function sn(n,o,t,s){const e=(s-o)/(t-n),r=o-e*n;return[e,r]}function U(n){return[n.posX,f.horizonY]}function B(n,o,t){d(n,o,t.posX,f.horizonY)}function Wn(n){A();const o=Xn(),t="horizon",s=h(t),e=q(t);k(e?W:s?D:w),d(0,n,o,n);const r=c=>{dn(c.y)};I({id:t,x:0,y:n-5,h:10,w:o,onDrag:r}),H()}function _n(n){A();const o=n.posX,t=f.horizonY,s="vp"+n.id,e=h(s),r=q(s);T(r?W:e?D:w),fn(o,t);const c=i=>{kn(n.id,{posX:i.x})};I({id:s,x:o-5,y:t-5,h:10,w:10,onDrag:c}),H()}const Gn=n=>{Bn(On(n,$n)),dn(400)};Gn(document.getElementById("cubes"));
