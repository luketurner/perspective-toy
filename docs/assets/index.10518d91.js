(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))e(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&e(c)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerpolicy&&(s.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?s.credentials="include":r.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function e(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();let q=[];const Do=o=>{const t=q.findIndex(n=>n.id===o);t>=0&&q.splice(t,1)},U=o=>{Do(o.id),q.push(o)},uo=(o,t)=>{const n=[];for(const e of q)if(e.path)if(Array.isArray(e.path)){for(const r of e.path)if(l.isPointInPath(r,o,t)){n.push(e);break}}else l.isPointInPath(e.path,o,t)&&n.push(e);else{const{x:r,y:s,w:c,h:i}=e;o>=r&&o<=r+c&&t>=s&&t<=s+i&&n.push(e)}return n},ho=(o,t)=>uo(o,t).pop(),yo=()=>{q=[]};let fo=1;const K=[],to=(o,t)=>{for(const n of o==="after"?[...K].reverse():K){const e=n[o];e&&e(t)}},Co=o=>{ko(o.id),K.push(o)},ko=o=>{const t=K.findIndex(n=>n.id===o);t>=0&&K.splice(t,1)},f=o=>{to("before",u),u=o(u),to("after",u)};let u={shapes:{},vps:{},horizonY:0,dragging:!1,dragTarget:void 0,hoveredBoxes:{}};const Ao=o=>({id:fo++,posX:0,...o}),Io=o=>({id:fo++,type:"cube",persp:"1p",position:[0,0],size:[100,100],vps:[],...o}),po=o=>{f(t=>(t.horizonY=o,t))},G=o=>{const t=Ao(o);return f(n=>(n.vps[t.id]=t,n)),t},Lo=o=>{const t=Io(o);return f(n=>(n.shapes[t.id]=t,n)),t},Xo=(o,t)=>{f(n=>{const e=n.shapes[o];return e&&(n.shapes[o]={...e,...t}),n})},go=(o,t,n)=>{f(e=>{const r=e.shapes[o];return r&&(r.position=[r.position[0]+t,r.position[1]+n]),e})},zo=(o,t)=>{f(n=>{const e=n.vps[o];return e&&(n.vps[o]={...e,...t}),n})},Ho=o=>{f(t=>(delete t.shapes[o],t))},no=o=>{f(t=>(delete t.vps[o],t))},So=()=>f(o=>(o.shapes={},o)),Yo=()=>f(o=>(o.vps={},o)),Vo=o=>f(t=>(t.dragging=!0,t.dragTarget=o,t)),Eo=()=>f(o=>(o.dragging=!1,o.dragTarget=void 0,o)),P=o=>!!u.hoveredBoxes[o],Mo=o=>{f(t=>(t.hoveredBoxes={[o]:!0},t))},Oo=o=>{f(t=>(delete t.hoveredBoxes[o],t))},vo=o=>{var t;return o&&((t=u.dragTarget)==null?void 0:t.id)===o};let l,Po;const Fo=o=>(o==null?void 0:o.nodeName)==="CANVAS",Q=(o,t,n,e)=>{l.beginPath(),l.moveTo(o,t),l.lineTo(n,e),l.stroke()},Ro=(o,t)=>{l.beginPath(),l.ellipse(o,t,4,4,0,0,2*Math.PI),l.fill()},No=()=>l.clearRect(0,0,l.canvas.width,l.canvas.height),$=o=>{l.fillStyle=o},L=o=>{l.strokeStyle=o},eo=o=>{l.font=o},W=o=>l.measureText(o),_=(o,t,n)=>{l.fillText(o,t,n)},mo=(o,t,n,e)=>l.strokeRect(o,t,n,e),Y=()=>l.save(),V=()=>l.restore(),jo=()=>l.canvas.width;function Uo(o,t){const n=ho(o,t);!(n!=null&&n.onDrag)||Vo(n)}function $o(o,t){var n,e;u.dragging?Eo():(e=(n=ho(o,t))==null?void 0:n.onClick)==null||e.call(n)}function so(o,t,n,e){var s,c;u.dragging&&((c=(s=u.dragTarget)==null?void 0:s.onDrag)==null||c.call(s,{x:o,y:t,dx:n,dy:e}));const r=uo(o,t);for(const i of r)i&&!P(i.id)&&Mo(i.id);for(const i of Object.keys(u.hoveredBoxes))r.find(a=>a.id===i)||Oo(i)}const qo=()=>{No(),yo(),l.save(),Po(),l.restore()},Ko=(o,t)=>{if(!Fo(o))throw new Error(`invalid element: ${o}`);const n=o.getContext("2d");if(!n)throw new Error(`Cannot find 2D Context for element: ${o}`);if(typeof t!="function")throw new Error(`renderFn ${t} is not a function`);return l=n,Po=t,o.addEventListener("pointerdown",e=>Uo(e.offsetX,e.offsetY)),o.addEventListener("pointerup",e=>$o(e.offsetX,e.offsetY)),o.addEventListener("pointermove",e=>e.pointerType==="touch"?so(e.offsetX,e.offsetY,-e.movementX,-e.movementY):so(e.offsetX,e.offsetY,e.movementX,e.movementY)),{after:e=>requestAnimationFrame(qo),id:"draw"}},y="#44403c",To="#a8a29e",S="#4d7c0f",xo="#a8a29e",wo="#4d7c0f",ro="#6366f1",co="#4338ca",Z="#dc2626";function Wo(){eo("20px monospace"),Qo(16,16,8,(o,t)=>_o(o,t)),eo("16px monospace"),bo(16,750,8,(o,t)=>Jo(o,t,"luketurner/perspective-toy","footer-github","https://github.com/luketurner/perspective-toy"),(o,t)=>Bo(o,t,"Copyright 2022 Luke Turner"))}function _o(o,t){return bo(o,t,8,(n,e)=>Bo(n,e,"CUBES"),(n,e)=>io(n,e,"ADD","addCube",()=>{const r=G({posX:400});Lo({persp:"1p",position:[350,600],size:[100,100],vps:[r.id]})}),...Object.keys(u.shapes).map((n,e)=>(r,s)=>Go(r,s,n,(e+1).toString())),(n,e)=>io(n,e,"CLR","clearCube",()=>{So(),Yo()},Z))}function Go(o,t,n,e){Y();const r="cubeBtn"+n,s="cube"+n,c=P(r)||P(s);$(c?S:y),L(c?S:y);const i=4,a=W(e),d=a.width+i*2,h=a.actualBoundingBoxAscent+a.actualBoundingBoxDescent+i*2;return mo(o,t,d,h),_(e,o+i,t+a.actualBoundingBoxAscent+i),V(),U({x:o,y:t,w:d,h,id:r,onClick:()=>{const m=parseInt(n,10),T=u.shapes[n];if(T.persp==="1p"){const x=G({posX:200}),C=G({posX:600}),k=T.vps;Xo(m,{persp:"2p",vps:[x.id,C.id]});for(const A of k)no(A)}else{Ho(m);for(const x of T.vps)no(x)}}}),{w:d,h}}function io(o,t,n,e,r,s){Y();const c=P(e);$(c?s||S:y),L(c?s||S:y);const i=4,a=W(n),d=a.width+i*2,h=a.actualBoundingBoxAscent+a.actualBoundingBoxDescent+i*2;return mo(o,t,d,h),_(n,o+i,t+a.actualBoundingBoxAscent+i),V(),U({x:o,y:t,w:d,h,id:e,onClick:r}),{w:d,h}}function Jo(o,t,n,e,r){Y();const s=P(e);$(s?co:ro),L(s?co:ro);const c=4,i=W(n),a=i.width+c*2,d=i.actualBoundingBoxAscent+i.actualBoundingBoxDescent+c*2;return _(n,o+c,t+i.actualBoundingBoxAscent+c),Q(o+c,t+i.actualBoundingBoxAscent+c+2,o+a-c,t+i.actualBoundingBoxAscent+c+2),V(),U({x:o,y:t,w:a,h:d,id:e,onClick:()=>{window.open(r,"_blank")}}),{w:a,h:d}}function Bo(o,t,n){Y(),$(y);const e=4,r=W(n),s=r.width+e*2,c=r.actualBoundingBoxAscent+r.actualBoundingBoxDescent+e*2;return _(n,o+e,t+r.actualBoundingBoxAscent+e),V(),{w:s,h:c}}function Qo(o,t,n,...e){let r=t,s=0;for(const c of e){const{h:i,w:a}=c(o,r);r+=i+n,s=Math.max(a,s)}return{w:s,h:r-t}}function bo(o,t,n,...e){let r=o,s=0;for(const c of e){const{w:i,h:a}=c(r,t);r+=i+n,s=Math.max(a,s)}return{h:s,w:r-o}}const Zo=()=>{L(y),$(y),Wo(),nt(u.horizonY);for(const o of Object.values(u.shapes))o.persp==="1p"?ot(o):tt(o);for(const o of Object.values(u.vps))et(o)};function ot(o){Y();const t="cube"+o.id,n=P("clearCube"),e=P(t)||P("cubeBtn"+o.id),r=.25,[s,c]=o.position,[i,a]=o.size,d=u.vps[o.vps[0]],[h,I]=H(s,c,r,d),[m,T]=H(s+i,c,r,d),[x,C]=H(s,c+i,r,d),[k,A]=H(s+i,c+i,r,d);L(e?xo:To),D(s,c,d),D(s,c+i,d),D(s+i,c,d),D(s+i,c+i,d),L(n?Z:e?S:y);const X=new Path2D;X.rect(s,c,i,a);const w=new Path2D;w.moveTo(s,c),w.lineTo(h,I),w.lineTo(m,T),w.lineTo(s+i,c),w.closePath();const B=new Path2D;B.moveTo(s,c+a),B.lineTo(x,C),B.lineTo(k,A),B.lineTo(s+i,c+a),B.closePath();const b=new Path2D;b.moveTo(s,c),b.lineTo(h,I),b.lineTo(x,C),b.lineTo(s,c+a),b.closePath();const p=new Path2D;p.moveTo(s+i,c),p.lineTo(m,T),p.lineTo(k,A),p.lineTo(s+i,c+a),p.closePath();const g=new Path2D;g.moveTo(h,I),g.lineTo(m,T),g.lineTo(k,A),g.lineTo(x,C),g.closePath();const v=new Path2D;v.addPath(w),v.addPath(B),v.addPath(b),v.addPath(g),v.addPath(X),v.addPath(p),l.stroke(v),U({id:t,path:[w,B,b,g,X,p],onDrag(z){go(o.id,z.dx,z.dy)}}),V()}function tt(o){Y();const t="cube"+o.id,n=P("clearCube"),e=P(t)||P("cubeBtn"+o.id),r=.25,[s,c]=o.position,[i]=o.size,a=u.vps[o.vps[0]],d=u.vps[o.vps[1]],[h,I]=J(a),[m,T]=J(d),[x,C]=H(s,c,r,a),[k,A]=H(s,c,r,d),[X,w]=H(s,c+i,r,a),[B,b]=H(s,c+i,r,d),[p,g]=ao(x,C,m,T,k,A,h,I),[v,z]=ao(X,w,m,T,B,b,h,I);L(e?xo:To),D(s,c,a),D(s,c+i,a),D(s,c,d),D(s,c+i,d),D(p,g,a),D(p,g,d),D(v,z,a),D(v,z,d),L(n?Z:e?S:y);const E=new Path2D;E.moveTo(s,c),E.lineTo(x,C),E.lineTo(p,g),E.lineTo(k,A),E.closePath();const M=new Path2D;M.moveTo(s,c+i),M.lineTo(X,w),M.lineTo(v,z),M.lineTo(B,b),M.closePath();const O=new Path2D;O.moveTo(s,c),O.lineTo(x,C),O.lineTo(X,w),O.lineTo(s,c+i),O.closePath();const F=new Path2D;F.moveTo(x,C),F.lineTo(p,g),F.lineTo(v,z),F.lineTo(X,w),F.closePath();const R=new Path2D;R.moveTo(s,c),R.lineTo(k,A),R.lineTo(B,b),R.lineTo(s,c+i),R.closePath();const N=new Path2D;N.moveTo(k,A),N.lineTo(p,g),N.lineTo(v,z),N.lineTo(B,b),N.closePath();const j=new Path2D;j.addPath(E),j.addPath(M),j.addPath(O),j.addPath(F),j.addPath(R),j.addPath(N),l.stroke(j),U({id:t,path:[E,M,O,F,R,N],onDrag(oo){go(o.id,oo.dx,oo.dy)}}),V()}function H(o,t,n,e){const[r,s]=J(e),c=(r-o)*n,i=(s-t)*n;return[o+c,t+i]}function ao(o,t,n,e,r,s,c,i){const[a,d]=lo(o,t,n,e),[h,I]=lo(r,s,c,i),m=(I-d)/(a-h),T=a*m+d;return[m,T]}function lo(o,t,n,e){const r=(e-t)/(n-o),s=t-r*o;return[r,s]}function J(o){return[o.posX,u.horizonY]}function D(o,t,n){Q(o,t,n.posX,u.horizonY)}function nt(o){Y();const t=jo(),n="horizon",e=P(n),r=vo(n);L(r?wo:e?S:y),Q(0,o,t,o);const s=c=>{po(c.y)};U({id:n,x:0,y:o-5,h:10,w:t,onDrag:s}),V()}function et(o){Y();const t=o.posX,n=u.horizonY,e="vp"+o.id,r=P(e),s=vo(e);$(s?wo:r?S:y),Ro(t,n);const c=i=>{zo(o.id,{posX:i.x})};U({id:e,x:t-5,y:n-5,h:10,w:10,onDrag:c}),V()}const st=o=>{Co(Ko(o,Zo)),po(400)};st(document.getElementById("cubes"));
