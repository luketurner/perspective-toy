(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();let P=[];const q=n=>{const t=P.findIndex(e=>e.id===n);t>=0&&P.splice(t,1)},E=n=>{q(n.id),P.push(n)},M=(n,t)=>{const e=[];for(const o of P){const{x:s,y:r,w:c,h:a}=o;n>=s&&n<=s+c&&t>=r&&t<=r+a&&e.push(o)}return e},j=(n,t)=>M(n,t).pop(),K=()=>({before:()=>{P=[]},id:"boxHandler"});let N=1;const D=[],Y=(n,t)=>{for(const e of n==="after"?[...D].reverse():D){const o=e[n];o&&o(t)}},A=n=>{G(n.id),D.push(n)},G=n=>{const t=D.findIndex(e=>e.id===n);t>=0&&D.splice(t,1)},l=n=>{Y("before",f),f=n(f),Y("after",f)};let f={shapes:{},vps:{},horizonY:0,dragging:!1,dragTarget:void 0,hoveredBoxes:{}};const J=n=>({id:N++,posX:0,...n}),Q=n=>({id:N++,type:"cube",persp:"1p",position:[0,0],size:[100,100],vps:[],...n}),U=n=>{l(t=>(t.horizonY=n,t))},W=n=>{const t=J(n);return l(e=>(e.vps[t.id]=t,e)),t},Z=n=>{const t=Q(n);return l(e=>(e.shapes[t.id]=t,e)),t},_=(n,t)=>{l(e=>{const o=e.vps[n];return o&&(e.vps[n]={...o,...t}),e})},nn=n=>{l(t=>(delete t.shapes[n],t))},tn=n=>{l(t=>(delete t.vps[n],t))},en=()=>l(n=>(n.shapes={},n)),on=()=>l(n=>(n.vps={},n)),sn=n=>l(t=>(t.dragging=!0,t.dragTarget=n,t)),rn=()=>l(n=>(n.dragging=!1,n.dragTarget=void 0,n)),H=n=>!!f.hoveredBoxes[n],cn=n=>{l(t=>(t.hoveredBoxes={[n]:!0},t))},an=n=>{l(t=>(delete t.hoveredBoxes[n],t))},F=n=>{var t;return n&&((t=f.dragTarget)==null?void 0:t.id)===n};function dn(){return pn(16,16,8,(n,t)=>O(n,t,"PERSPECTIVE TOY"),(n,t)=>un(n,t),(n,t)=>fn(n,t))}function un(n,t){return $(n,t,8,(e,o)=>O(e,o,"V.PTS"),(e,o)=>y(e,o,"ADD","addVp",()=>W({posX:100})),...Object.keys(f.vps).map(e=>(o,s)=>y(o,s,e.toString(),"delVp"+e,()=>tn(parseInt(e,10)))),(e,o)=>y(e,o,"CLR","clearVp",()=>on()))}function fn(n,t){return $(n,t,8,(e,o)=>O(e,o,"CUBES"),(e,o)=>y(e,o,"ADD","addCube",()=>Z({persp:"1p",position:[350,600],size:[100,100],vps:[parseInt(Object.keys(f.vps)[0],10)]})),...Object.keys(f.shapes).map(e=>(o,s)=>y(o,s,e,"delCube"+e,()=>nn(parseInt(e,10)))),(e,o)=>y(e,o,"CLR","clearCube",()=>en()))}function y(n,t,e,o,s){i.save(),i.strokeStyle="black",i.font="18px monospace";const r=2,c=i.measureText(e),a=c.width+r*2,u=c.actualBoundingBoxAscent+c.actualBoundingBoxDescent+r*2;return i.strokeRect(n,t,a,u),i.fillText(e,n+r,t+c.actualBoundingBoxAscent+r),E({x:n,y:t,w:a,h:u,id:o,onClick:s}),i.restore(),{w:a,h:u}}function O(n,t,e){i.save(),i.strokeStyle="black",i.font="18px monospace";const o=2,s=i.measureText(e),r=s.width+o*2,c=s.actualBoundingBoxAscent+s.actualBoundingBoxDescent+o*2;return i.fillText(e,n+o,t+s.actualBoundingBoxAscent+o),i.restore(),{w:r,h:c}}function pn(n,t,e,...o){let s=t,r=0;for(const c of o){const{h:a,w:u}=c(n,s);s+=a+e,r=Math.max(u,r)}return{w:r,h:s-t}}function $(n,t,e,...o){let s=n,r=0;for(const c of o){const{w:a,h:u}=c(s,t);s+=a+e,r=Math.max(u,r)}return{h:r,w:s-n}}let i;const ln=(n,t)=>{const e=n.getContext("2d");if(!e)throw new Error(`Cannot find 2D Context for element: ${n}`);i=e,yn(),vn(t.horizonY),dn();for(const o of Object.values(t.vps))xn(o);for(const o of Object.values(t.shapes))o.persp==="1p"?hn(o):gn(o)};function hn(n){const[e,o]=n.position,[s]=n.size,r=f.vps[n.vps[0]];p(e,o,r),p(e,o+s,r),p(e+s,o,r),p(e+s,o+s,r);const[c,a]=b(e,o,.25,r),[u,x]=b(e+s,o,.25,r),[m,g]=b(e,o+s,.25,r),[h,v]=b(e+s,o+s,.25,r);mn(e,o,s,s),d(e,o,c,a),d(e+s,o,u,x),d(e,o+s,m,g),d(e+s,o+s,h,v),d(c,a,u,x),d(c,a,m,g),d(u,x,h,v),d(m,g,h,v)}function gn(n){const[e,o]=n.position,[s]=n.size,r=f.vps[n.vps[0]],c=f.vps[n.vps[1]];d(e,o,e,o+s),p(e,o,r),p(e,o+s,r),p(e,o,c),p(e,o+s,c);const[a,u]=L(r),[x,m]=L(c),[g,h]=b(e,o,.25,r),[v,T]=b(e,o,.25,c),[V,I]=b(e,o+s,.25,r),[z,S]=b(e,o+s,.25,c),[w,B]=X(g,h,x,m,v,T,a,u),[C,k]=X(V,I,x,m,z,S,a,u);p(w,B,r),p(w,B,c),p(C,k,r),p(C,k,c),d(e,o,g,h),d(e,o,v,T),d(g,h,w,B),d(v,T,w,B),d(e,o+s,V,I),d(e,o+s,z,S),d(V,I,C,k),d(z,S,C,k),d(g,h,V,I),d(v,T,z,S),d(w,B,C,k)}function b(n,t,e,o){const[s,r]=L(o),c=(s-n)*e,a=(r-t)*e;return[n+c,t+a]}function X(n,t,e,o,s,r,c,a){const[u,x]=R(n,t,e,o),[m,g]=R(s,r,c,a),h=(g-x)/(u-m),v=u*h+x;return[h,v]}function R(n,t,e,o){const s=(o-t)/(e-n),r=t-s*n;return[s,r]}function L(n){return[n.posX,f.horizonY]}function p(n,t,e){d(n,t,e.posX,f.horizonY,"grey")}function vn(n){const t=i.canvas.width,e="horizon",o=H(e),s=F(e);d(0,n,t,n,s?"orange":o?"blue":"grey");const r=c=>{U(c.y)};E({id:e,x:0,y:n-5,h:10,w:t,onDrag:r})}function xn(n){const t=n.posX,e=f.horizonY,o="vp"+n.id,s=H(o),r=F(o);bn(t,e,r?"orange":s?"blue":"black");const c=a=>{_(n.id,{posX:a.x})};E({id:o,x:t-5,y:e-5,h:10,w:10,onDrag:c})}function mn(n,t,e,o,s="black"){i.beginPath(),i.rect(n,t,e,o),i.strokeStyle=s,i.stroke()}function d(n,t,e,o,s="black"){i.beginPath(),i.moveTo(n,t),i.lineTo(e,o),i.strokeStyle=s,i.stroke()}function bn(n,t,e="black"){i.save(),i.beginPath(),i.ellipse(n,t,4,4,0,0,2*Math.PI),i.fillStyle=e,i.fill(),i.restore()}function yn(){i.clearRect(0,0,i.canvas.width,i.canvas.height)}const wn=n=>({after:t=>ln(n,t),id:"draw"}),Bn=n=>(n==null?void 0:n.nodeName)==="CANVAS";function Cn(n,t){const e=j(n,t);!(e!=null&&e.onDrag)||sn(e)}function kn(n,t){var e,o;f.dragging?rn():(o=(e=j(n,t))==null?void 0:e.onClick)==null||o.call(e)}function Pn(n,t,e,o){var r,c;f.dragging&&((c=(r=f.dragTarget)==null?void 0:r.onDrag)==null||c.call(r,{x:n,y:t,dx:e,dy:o}));const s=M(n,t);for(const a of s)a&&!H(a.id)&&cn(a.id);for(const a of Object.keys(f.hoveredBoxes))s.find(u=>u.id===a)||an(a)}const Dn=n=>{if(!Bn(n))throw new Error(`invalid element: ${n}`);n.addEventListener("mousedown",t=>{Cn(t.offsetX,t.offsetY)}),n.addEventListener("mousemove",t=>{Pn(t.offsetX,t.offsetY,t.movementX,t.movementY)}),n.addEventListener("mouseup",t=>{kn(t.offsetX,t.offsetY)}),A(K()),A(wn(n)),U(400)};Dn(document.getElementById("cubes"));
