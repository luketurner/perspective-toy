(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))e(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&e(c)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerpolicy&&(s.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?s.credentials="include":r.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function e(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();let q=[];const bo=o=>{const t=q.findIndex(n=>n.id===o);t>=0&&q.splice(t,1)},U=o=>{bo(o.id),q.push(o)},lo=(o,t)=>{const n=[];for(const e of q)if(e.path)if(Array.isArray(e.path)){for(const r of e.path)if(l.isPointInPath(r,o,t)){n.push(e);break}}else l.isPointInPath(e.path,o,t)&&n.push(e);else{const{x:r,y:s,w:c,h:i}=e;o>=r&&o<=r+c&&t>=s&&t<=s+i&&n.push(e)}return n},uo=(o,t)=>lo(o,t).pop(),Do=()=>{q=[]};let ho=1;const K=[],to=(o,t)=>{for(const n of o==="after"?[...K].reverse():K){const e=n[o];e&&e(t)}},yo=o=>{Co(o.id),K.push(o)},Co=o=>{const t=K.findIndex(n=>n.id===o);t>=0&&K.splice(t,1)},f=o=>{to("before",u),u=o(u),to("after",u)};let u={shapes:{},vps:{},horizonY:0,dragging:!1,dragTarget:void 0,hoveredBoxes:{}};const ko=o=>({id:ho++,posX:0,...o}),Ao=o=>({id:ho++,type:"cube",persp:"1p",position:[0,0],size:[100,100],vps:[],...o}),fo=o=>{f(t=>(t.horizonY=o,t))},G=o=>{const t=ko(o);return f(n=>(n.vps[t.id]=t,n)),t},Io=o=>{const t=Ao(o);return f(n=>(n.shapes[t.id]=t,n)),t},Lo=(o,t)=>{f(n=>{const e=n.shapes[o];return e&&(n.shapes[o]={...e,...t}),n})},po=(o,t,n)=>{f(e=>{const r=e.shapes[o];return r&&(r.position=[r.position[0]+t,r.position[1]+n]),e})},zo=(o,t)=>{f(n=>{const e=n.vps[o];return e&&(n.vps[o]={...e,...t}),n})},Ho=o=>{f(t=>(delete t.shapes[o],t))},no=o=>{f(t=>(delete t.vps[o],t))},So=()=>f(o=>(o.shapes={},o)),Xo=()=>f(o=>(o.vps={},o)),Vo=o=>f(t=>(t.dragging=!0,t.dragTarget=o,t)),Yo=()=>f(o=>(o.dragging=!1,o.dragTarget=void 0,o)),P=o=>!!u.hoveredBoxes[o],Eo=o=>{f(t=>(t.hoveredBoxes={[o]:!0},t))},Mo=o=>{f(t=>(delete t.hoveredBoxes[o],t))},go=o=>{var t;return o&&((t=u.dragTarget)==null?void 0:t.id)===o};let l,vo;const Oo=o=>(o==null?void 0:o.nodeName)==="CANVAS",Q=(o,t,n,e)=>{l.beginPath(),l.moveTo(o,t),l.lineTo(n,e),l.stroke()},Fo=(o,t)=>{l.beginPath(),l.ellipse(o,t,4,4,0,0,2*Math.PI),l.fill()},Ro=()=>l.clearRect(0,0,l.canvas.width,l.canvas.height),$=o=>{l.fillStyle=o},L=o=>{l.strokeStyle=o},eo=o=>{l.font=o},W=o=>l.measureText(o),_=(o,t,n)=>{l.fillText(o,t,n)},Po=(o,t,n,e)=>l.strokeRect(o,t,n,e),V=()=>l.save(),Y=()=>l.restore(),No=()=>l.canvas.width;function jo(o,t){const n=uo(o,t);!(n!=null&&n.onDrag)||Vo(n)}function Uo(o,t){var n,e;u.dragging?Yo():(e=(n=uo(o,t))==null?void 0:n.onClick)==null||e.call(n)}function $o(o,t,n,e){var s,c;u.dragging&&((c=(s=u.dragTarget)==null?void 0:s.onDrag)==null||c.call(s,{x:o,y:t,dx:n,dy:e}));const r=lo(o,t);for(const i of r)i&&!P(i.id)&&Eo(i.id);for(const i of Object.keys(u.hoveredBoxes))r.find(a=>a.id===i)||Mo(i)}const qo=()=>{Ro(),Do(),l.save(),vo(),l.restore()},Ko=(o,t)=>{if(!Oo(o))throw new Error(`invalid element: ${o}`);const n=o.getContext("2d");if(!n)throw new Error(`Cannot find 2D Context for element: ${o}`);if(typeof t!="function")throw new Error(`renderFn ${t} is not a function`);return l=n,vo=t,o.addEventListener("mousedown",e=>jo(e.offsetX,e.offsetY)),o.addEventListener("mouseup",e=>Uo(e.offsetX,e.offsetY)),o.addEventListener("mousemove",e=>$o(e.offsetX,e.offsetY,e.movementX,e.movementY)),{after:e=>requestAnimationFrame(qo),id:"draw"}},y="#44403c",mo="#a8a29e",X="#4d7c0f",To="#a8a29e",xo="#4d7c0f",so="#6366f1",ro="#4338ca",Z="#dc2626";function Wo(){eo("20px monospace"),Qo(16,16,8,(o,t)=>_o(o,t)),eo("16px monospace"),Bo(16,750,8,(o,t)=>Jo(o,t,"luketurner/perspective-toy","footer-github","https://github.com/luketurner/perspective-toy"),(o,t)=>wo(o,t,"Copyright 2022 Luke Turner"))}function _o(o,t){return Bo(o,t,8,(n,e)=>wo(n,e,"CUBES"),(n,e)=>co(n,e,"ADD","addCube",()=>{const r=G({posX:400});Io({persp:"1p",position:[350,600],size:[100,100],vps:[r.id]})}),...Object.keys(u.shapes).map((n,e)=>(r,s)=>Go(r,s,n,(e+1).toString())),(n,e)=>co(n,e,"CLR","clearCube",()=>{So(),Xo()},Z))}function Go(o,t,n,e){V();const r="cubeBtn"+n,s="cube"+n,c=P(r)||P(s);$(c?X:y),L(c?X:y);const i=4,a=W(e),d=a.width+i*2,h=a.actualBoundingBoxAscent+a.actualBoundingBoxDescent+i*2;return Po(o,t,d,h),_(e,o+i,t+a.actualBoundingBoxAscent+i),Y(),U({x:o,y:t,w:d,h,id:r,onClick:()=>{const m=parseInt(n,10),T=u.shapes[n];if(T.persp==="1p"){const x=G({posX:200}),C=G({posX:600}),k=T.vps;Lo(m,{persp:"2p",vps:[x.id,C.id]});for(const A of k)no(A)}else{Ho(m);for(const x of T.vps)no(x)}}}),{w:d,h}}function co(o,t,n,e,r,s){V();const c=P(e);$(c?s||X:y),L(c?s||X:y);const i=4,a=W(n),d=a.width+i*2,h=a.actualBoundingBoxAscent+a.actualBoundingBoxDescent+i*2;return Po(o,t,d,h),_(n,o+i,t+a.actualBoundingBoxAscent+i),Y(),U({x:o,y:t,w:d,h,id:e,onClick:r}),{w:d,h}}function Jo(o,t,n,e,r){V();const s=P(e);$(s?ro:so),L(s?ro:so);const c=4,i=W(n),a=i.width+c*2,d=i.actualBoundingBoxAscent+i.actualBoundingBoxDescent+c*2;return _(n,o+c,t+i.actualBoundingBoxAscent+c),Q(o+c,t+i.actualBoundingBoxAscent+c+2,o+a-c,t+i.actualBoundingBoxAscent+c+2),Y(),U({x:o,y:t,w:a,h:d,id:e,onClick:()=>{window.open(r,"_blank")}}),{w:a,h:d}}function wo(o,t,n){V(),$(y);const e=4,r=W(n),s=r.width+e*2,c=r.actualBoundingBoxAscent+r.actualBoundingBoxDescent+e*2;return _(n,o+e,t+r.actualBoundingBoxAscent+e),Y(),{w:s,h:c}}function Qo(o,t,n,...e){let r=t,s=0;for(const c of e){const{h:i,w:a}=c(o,r);r+=i+n,s=Math.max(a,s)}return{w:s,h:r-t}}function Bo(o,t,n,...e){let r=o,s=0;for(const c of e){const{w:i,h:a}=c(r,t);r+=i+n,s=Math.max(a,s)}return{h:s,w:r-o}}const Zo=()=>{L(y),$(y),Wo(),nt(u.horizonY);for(const o of Object.values(u.shapes))o.persp==="1p"?ot(o):tt(o);for(const o of Object.values(u.vps))et(o)};function ot(o){V();const t="cube"+o.id,n=P("clearCube"),e=P(t)||P("cubeBtn"+o.id),r=.25,[s,c]=o.position,[i,a]=o.size,d=u.vps[o.vps[0]],[h,I]=S(s,c,r,d),[m,T]=S(s+i,c,r,d),[x,C]=S(s,c+i,r,d),[k,A]=S(s+i,c+i,r,d);L(e?To:mo),D(s,c,d),D(s,c+i,d),D(s+i,c,d),D(s+i,c+i,d),L(n?Z:e?X:y);const z=new Path2D;z.rect(s,c,i,a);const w=new Path2D;w.moveTo(s,c),w.lineTo(h,I),w.lineTo(m,T),w.lineTo(s+i,c),w.closePath();const B=new Path2D;B.moveTo(s,c+a),B.lineTo(x,C),B.lineTo(k,A),B.lineTo(s+i,c+a),B.closePath();const b=new Path2D;b.moveTo(s,c),b.lineTo(h,I),b.lineTo(x,C),b.lineTo(s,c+a),b.closePath();const p=new Path2D;p.moveTo(s+i,c),p.lineTo(m,T),p.lineTo(k,A),p.lineTo(s+i,c+a),p.closePath();const g=new Path2D;g.moveTo(h,I),g.lineTo(m,T),g.lineTo(k,A),g.lineTo(x,C),g.closePath();const v=new Path2D;v.addPath(w),v.addPath(B),v.addPath(b),v.addPath(g),v.addPath(z),v.addPath(p),l.stroke(v),U({id:t,path:[w,B,b,g,z,p],onDrag(H){po(o.id,H.dx,H.dy)}}),Y()}function tt(o){V();const t="cube"+o.id,n=P("clearCube"),e=P(t)||P("cubeBtn"+o.id),r=.25,[s,c]=o.position,[i]=o.size,a=u.vps[o.vps[0]],d=u.vps[o.vps[1]],[h,I]=J(a),[m,T]=J(d),[x,C]=S(s,c,r,a),[k,A]=S(s,c,r,d),[z,w]=S(s,c+i,r,a),[B,b]=S(s,c+i,r,d),[p,g]=io(x,C,m,T,k,A,h,I),[v,H]=io(z,w,m,T,B,b,h,I);L(e?To:mo),D(s,c,a),D(s,c+i,a),D(s,c,d),D(s,c+i,d),D(p,g,a),D(p,g,d),D(v,H,a),D(v,H,d),L(n?Z:e?X:y);const E=new Path2D;E.moveTo(s,c),E.lineTo(x,C),E.lineTo(p,g),E.lineTo(k,A),E.closePath();const M=new Path2D;M.moveTo(s,c+i),M.lineTo(z,w),M.lineTo(v,H),M.lineTo(B,b),M.closePath();const O=new Path2D;O.moveTo(s,c),O.lineTo(x,C),O.lineTo(z,w),O.lineTo(s,c+i),O.closePath();const F=new Path2D;F.moveTo(x,C),F.lineTo(p,g),F.lineTo(v,H),F.lineTo(z,w),F.closePath();const R=new Path2D;R.moveTo(s,c),R.lineTo(k,A),R.lineTo(B,b),R.lineTo(s,c+i),R.closePath();const N=new Path2D;N.moveTo(k,A),N.lineTo(p,g),N.lineTo(v,H),N.lineTo(B,b),N.closePath();const j=new Path2D;j.addPath(E),j.addPath(M),j.addPath(O),j.addPath(F),j.addPath(R),j.addPath(N),l.stroke(j),U({id:t,path:[E,M,O,F,R,N],onDrag(oo){po(o.id,oo.dx,oo.dy)}}),Y()}function S(o,t,n,e){const[r,s]=J(e),c=(r-o)*n,i=(s-t)*n;return[o+c,t+i]}function io(o,t,n,e,r,s,c,i){const[a,d]=ao(o,t,n,e),[h,I]=ao(r,s,c,i),m=(I-d)/(a-h),T=a*m+d;return[m,T]}function ao(o,t,n,e){const r=(e-t)/(n-o),s=t-r*o;return[r,s]}function J(o){return[o.posX,u.horizonY]}function D(o,t,n){Q(o,t,n.posX,u.horizonY)}function nt(o){V();const t=No(),n="horizon",e=P(n),r=go(n);L(r?xo:e?X:y),Q(0,o,t,o);const s=c=>{fo(c.y)};U({id:n,x:0,y:o-5,h:10,w:t,onDrag:s}),Y()}function et(o){V();const t=o.posX,n=u.horizonY,e="vp"+o.id,r=P(e),s=go(e);$(s?xo:r?X:y),Fo(t,n);const c=i=>{zo(o.id,{posX:i.x})};U({id:e,x:t-5,y:n-5,h:10,w:10,onDrag:c}),Y()}const st=o=>{yo(Ko(o,Zo)),fo(400)};st(document.getElementById("cubes"));
